<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transactions in Off-chain Workers | Substrate Recipes</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="Substrate Recipes">
    <link rel="preload" href="/assets/css/0.styles.ad025e7c.css" as="style"><link rel="preload" href="/assets/js/app.66aa2515.js" as="script"><link rel="preload" href="/assets/js/3.911ff76f.js" as="script"><link rel="preload" href="/assets/js/1.8aeda072.js" as="script"><link rel="preload" href="/assets/js/43.611048bf.js" as="script"><link rel="prefetch" href="/assets/js/10.37829845.js"><link rel="prefetch" href="/assets/js/100.7dc1ff05.js"><link rel="prefetch" href="/assets/js/101.297542a2.js"><link rel="prefetch" href="/assets/js/102.4b4eb6e2.js"><link rel="prefetch" href="/assets/js/103.905924f6.js"><link rel="prefetch" href="/assets/js/104.9a8801c9.js"><link rel="prefetch" href="/assets/js/105.11789512.js"><link rel="prefetch" href="/assets/js/106.9bb37e6d.js"><link rel="prefetch" href="/assets/js/107.d8653b02.js"><link rel="prefetch" href="/assets/js/108.4d618824.js"><link rel="prefetch" href="/assets/js/109.a1a325b2.js"><link rel="prefetch" href="/assets/js/11.43f84402.js"><link rel="prefetch" href="/assets/js/110.68a078c9.js"><link rel="prefetch" href="/assets/js/111.2a53fdf3.js"><link rel="prefetch" href="/assets/js/112.2377b53a.js"><link rel="prefetch" href="/assets/js/113.c460dd88.js"><link rel="prefetch" href="/assets/js/114.b5d73637.js"><link rel="prefetch" href="/assets/js/115.362b464f.js"><link rel="prefetch" href="/assets/js/116.2f85b476.js"><link rel="prefetch" href="/assets/js/117.76166f7d.js"><link rel="prefetch" href="/assets/js/118.25e17ce9.js"><link rel="prefetch" href="/assets/js/119.57707c67.js"><link rel="prefetch" href="/assets/js/12.20df832d.js"><link rel="prefetch" href="/assets/js/120.11fde1fe.js"><link rel="prefetch" href="/assets/js/121.56c41d8d.js"><link rel="prefetch" href="/assets/js/122.fa2cde0f.js"><link rel="prefetch" href="/assets/js/123.e9f4d4f2.js"><link rel="prefetch" href="/assets/js/124.12b0dec3.js"><link rel="prefetch" href="/assets/js/125.bd4a279b.js"><link rel="prefetch" href="/assets/js/126.9ce34fdb.js"><link rel="prefetch" href="/assets/js/127.08cca44a.js"><link rel="prefetch" href="/assets/js/128.395287d4.js"><link rel="prefetch" href="/assets/js/129.e931c417.js"><link rel="prefetch" href="/assets/js/13.00771e07.js"><link rel="prefetch" href="/assets/js/130.a5142d14.js"><link rel="prefetch" href="/assets/js/131.b1f126da.js"><link rel="prefetch" href="/assets/js/132.abf2c947.js"><link rel="prefetch" href="/assets/js/133.117ebcf4.js"><link rel="prefetch" href="/assets/js/134.cc5c9f37.js"><link rel="prefetch" href="/assets/js/135.b1c243ff.js"><link rel="prefetch" href="/assets/js/136.7d231f73.js"><link rel="prefetch" href="/assets/js/137.9afb710a.js"><link rel="prefetch" href="/assets/js/14.469caac5.js"><link rel="prefetch" href="/assets/js/15.9cb4518c.js"><link rel="prefetch" href="/assets/js/16.a8755dd3.js"><link rel="prefetch" href="/assets/js/17.fd207c74.js"><link rel="prefetch" href="/assets/js/18.9ac8edf4.js"><link rel="prefetch" href="/assets/js/19.7fd9cce0.js"><link rel="prefetch" href="/assets/js/20.3ac6699b.js"><link rel="prefetch" href="/assets/js/21.9bd21d49.js"><link rel="prefetch" href="/assets/js/22.26135513.js"><link rel="prefetch" href="/assets/js/23.12ca47ae.js"><link rel="prefetch" href="/assets/js/24.07c26276.js"><link rel="prefetch" href="/assets/js/25.1fb4186a.js"><link rel="prefetch" href="/assets/js/26.c0b427e0.js"><link rel="prefetch" href="/assets/js/27.a4c80d07.js"><link rel="prefetch" href="/assets/js/28.32d98e1e.js"><link rel="prefetch" href="/assets/js/29.3c8c6d0a.js"><link rel="prefetch" href="/assets/js/30.bedbe07f.js"><link rel="prefetch" href="/assets/js/31.01411239.js"><link rel="prefetch" href="/assets/js/32.ecde9b68.js"><link rel="prefetch" href="/assets/js/33.a1c852e5.js"><link rel="prefetch" href="/assets/js/34.9719df17.js"><link rel="prefetch" href="/assets/js/35.91fde58d.js"><link rel="prefetch" href="/assets/js/36.845ccc35.js"><link rel="prefetch" href="/assets/js/37.66285bdf.js"><link rel="prefetch" href="/assets/js/38.cd20e592.js"><link rel="prefetch" href="/assets/js/39.b1b64548.js"><link rel="prefetch" href="/assets/js/4.da5852d0.js"><link rel="prefetch" href="/assets/js/40.32bbdbca.js"><link rel="prefetch" href="/assets/js/41.0d53a13c.js"><link rel="prefetch" href="/assets/js/42.9d946ef7.js"><link rel="prefetch" href="/assets/js/44.adc1e594.js"><link rel="prefetch" href="/assets/js/45.c0188aa0.js"><link rel="prefetch" href="/assets/js/46.2f873f85.js"><link rel="prefetch" href="/assets/js/47.ba4c91a1.js"><link rel="prefetch" href="/assets/js/48.1132b00d.js"><link rel="prefetch" href="/assets/js/49.f968d914.js"><link rel="prefetch" href="/assets/js/5.a9148791.js"><link rel="prefetch" href="/assets/js/50.b31d47c5.js"><link rel="prefetch" href="/assets/js/51.100251c5.js"><link rel="prefetch" href="/assets/js/52.7779e7f0.js"><link rel="prefetch" href="/assets/js/53.cfa95d58.js"><link rel="prefetch" href="/assets/js/54.4e7ad936.js"><link rel="prefetch" href="/assets/js/55.8e1edddc.js"><link rel="prefetch" href="/assets/js/56.62ea5681.js"><link rel="prefetch" href="/assets/js/57.8c30d45b.js"><link rel="prefetch" href="/assets/js/58.464b3b53.js"><link rel="prefetch" href="/assets/js/59.2bee6e64.js"><link rel="prefetch" href="/assets/js/6.f03db119.js"><link rel="prefetch" href="/assets/js/60.513bc06d.js"><link rel="prefetch" href="/assets/js/61.9e7fee01.js"><link rel="prefetch" href="/assets/js/62.9c94e5d6.js"><link rel="prefetch" href="/assets/js/63.a84d6d48.js"><link rel="prefetch" href="/assets/js/64.6b7f090e.js"><link rel="prefetch" href="/assets/js/65.bcda81a0.js"><link rel="prefetch" href="/assets/js/66.0b93a1c7.js"><link rel="prefetch" href="/assets/js/67.d44f3078.js"><link rel="prefetch" href="/assets/js/68.8f018cd9.js"><link rel="prefetch" href="/assets/js/69.1457865a.js"><link rel="prefetch" href="/assets/js/7.0285f972.js"><link rel="prefetch" href="/assets/js/70.69ca0a46.js"><link rel="prefetch" href="/assets/js/71.76290ed4.js"><link rel="prefetch" href="/assets/js/72.0338d739.js"><link rel="prefetch" href="/assets/js/73.10458f48.js"><link rel="prefetch" href="/assets/js/74.1c8ea971.js"><link rel="prefetch" href="/assets/js/75.4921f3a2.js"><link rel="prefetch" href="/assets/js/76.321dfdeb.js"><link rel="prefetch" href="/assets/js/77.19009647.js"><link rel="prefetch" href="/assets/js/78.a244a0af.js"><link rel="prefetch" href="/assets/js/79.504de44a.js"><link rel="prefetch" href="/assets/js/8.16c0171d.js"><link rel="prefetch" href="/assets/js/80.bfaf64db.js"><link rel="prefetch" href="/assets/js/81.57121759.js"><link rel="prefetch" href="/assets/js/82.8b432e26.js"><link rel="prefetch" href="/assets/js/83.b948393a.js"><link rel="prefetch" href="/assets/js/84.09f6b5ee.js"><link rel="prefetch" href="/assets/js/85.7fd8dffd.js"><link rel="prefetch" href="/assets/js/86.7fdcf982.js"><link rel="prefetch" href="/assets/js/87.98be7016.js"><link rel="prefetch" href="/assets/js/88.d0be9732.js"><link rel="prefetch" href="/assets/js/89.6ea5f56c.js"><link rel="prefetch" href="/assets/js/9.3daa8733.js"><link rel="prefetch" href="/assets/js/90.ffb91ca4.js"><link rel="prefetch" href="/assets/js/91.7950b460.js"><link rel="prefetch" href="/assets/js/92.6c4f61f1.js"><link rel="prefetch" href="/assets/js/93.ebd206ec.js"><link rel="prefetch" href="/assets/js/94.33f51bc2.js"><link rel="prefetch" href="/assets/js/95.99f5f9ae.js"><link rel="prefetch" href="/assets/js/96.ab5c56ad.js"><link rel="prefetch" href="/assets/js/97.83620689.js"><link rel="prefetch" href="/assets/js/98.341cdd7c.js"><link rel="prefetch" href="/assets/js/99.c619520d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ad025e7c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Substrate Recipes</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><!---->
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Substrate Recipes</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3-entrees/off-chain-workers/transactions.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont undefined"></i>
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/3-entrees/off-chain-workers/transactions.html" class="nav-link"><i class="iconfont undefined"></i>
  简体中文
</a></li></ul></div></div> <a href="https://github.com/tianxiemaochiyu/the_book_of_substrate_zh_CN" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><!----> <!----> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3-entrees/off-chain-workers/transactions.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont undefined"></i>
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/3-entrees/off-chain-workers/transactions.html" class="nav-link"><i class="iconfont undefined"></i>
  简体中文
</a></li></ul></div></div> <a href="https://github.com/tianxiemaochiyu/the_book_of_substrate_zh_CN" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/" class="sidebar-heading clickable router-link-active open"><span>Substrate</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Introduction.html" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/1-prepare-kitchen/index" class="sidebar-heading clickable"><span>1. Preparing Your Kitchen</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/1-prepare-kitchen/1-build-node.html" class="sidebar-link">1.1. Building A Node</a></li><li><a href="/1-prepare-kitchen/2-interact-node.html" class="sidebar-link">1.2. Interacting with a Node</a></li><li><a href="/1-prepare-kitchen/3-kitchen-organization.html" class="sidebar-link">1.3. Kitchen Organization</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/2-appetizers/index" class="sidebar-heading clickable"><span>2. Appetizers</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/2-appetizers/1-hello-substrate.html" class="sidebar-link">2.1. Hello Substrate</a></li><li><a href="/2-appetizers/2-storage-values.html" class="sidebar-link">2.2. Single Value Storage</a></li><li><a href="/2-appetizers/3-errors.html" class="sidebar-link">2.3. Handling Errors</a></li><li><a href="/2-appetizers/4-events.html" class="sidebar-link">2.4. Events Verify Execution</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/3-entrees/index" class="sidebar-heading clickable"><span>3. Entrees</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/3-entrees/storage-api/index" class="sidebar-heading clickable"><span>3.1. Runtime Storage API</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/3-entrees/storage-api/storage-maps.html" class="sidebar-link">3.1.1. Runtime Storage API</a></li><li><a href="/3-entrees/storage-api/cache.html" class="sidebar-link">3.1.2. Cache Locally &gt; Storage Calls</a></li><li><a href="/3-entrees/storage-api/vec-set.html" class="sidebar-link">3.1.3. Using Vectors as Sets</a></li><li><a href="/3-entrees/storage-api/map-set.html" class="sidebar-link">3.1.4. Using Maps as Sets</a></li><li><a href="/3-entrees/storage-api/double.html" class="sidebar-link">3.1.5. Subgroup Removal by Subkey: Double Maps</a></li><li><a href="/3-entrees/storage-api/structs.html" class="sidebar-link">3.1.6. Storing custom structs</a></li><li><a href="/3-entrees/storage-api/ringbuffer.html" class="sidebar-link">3.1.7. Ringbuffer Queue</a></li></ul></section></li><li><a href="/3-entrees/basic-token.html" class="sidebar-link">3.2. Basic Token</a></li><li><a href="/3-entrees/constants.html" class="sidebar-link">3.3. Configurable Constants</a></li><li><a href="/3-entrees/crowdfund.html" class="sidebar-link">3.4. Simple Crowdfund</a></li><li><a href="/3-entrees/instantiable.html" class="sidebar-link">3.5. Instantiable Pallets</a></li><li><a href="/3-entrees/weights.html" class="sidebar-link">3.6. Weights for Resource Accounting</a></li><li><a href="/3-entrees/fees.html" class="sidebar-link">3.7. Transaction Fees for Economic Security</a></li><li><a href="/3-entrees/charity.html" class="sidebar-link">3.8. Charity and Imbalances</a></li><li><a href="/3-entrees/fixed-point.html" class="sidebar-link">3.9. Fixed Point Arithmetic</a></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/3-entrees/off-chain-workers/index" class="sidebar-heading clickable open"><span>3.10. Off-chain Workers</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/3-entrees/off-chain-workers/transactions.html" aria-current="page" class="active sidebar-link">3.10.1. Transactions</a></li><li><a href="/3-entrees/off-chain-workers/http-json.html" class="sidebar-link">3.10.2. HTTP Fetching &amp; JSON Parsing</a></li><li><a href="/3-entrees/off-chain-workers/storage.html" class="sidebar-link">3.10.3. Local Storage</a></li></ul></section></li><li><a href="/3-entrees/runtime-api.html" class="sidebar-link">3.11. Runtime APIs</a></li><li><a href="/3-entrees/custom-rpc.html" class="sidebar-link">3.12. Custom RPCs</a></li><li><a href="/3-entrees/sha3-pow-consensus.html" class="sidebar-link">3.13. Sha3 Pow Consensus Algorithms</a></li><li><a href="/3-entrees/basic-pow.html" class="sidebar-link">3.14. Basic Proof of Work Node</a></li><li><a href="/3-entrees/hybrid-consensus.html" class="sidebar-link">3.15. Hybrid PoW/PoS Consensus Node</a></li><li><a href="/3-entrees/manual-seal.html" class="sidebar-link">3.16. Manual Seal Consensus</a></li><li><a href="/3-entrees/kitchen-node.html" class="sidebar-link">3.17. Kitchen Node - An reusable instant seal node</a></li><li><a href="/3-entrees/babe-grandpa-node.html" class="sidebar-link">3.18. Babe and Grandpa Node</a></li><li><a href="/3-entrees/currency.html" class="sidebar-link">3.19. Currency Types</a></li><li><a href="/3-entrees/randomness.html" class="sidebar-link">3.20. Generating Randomness</a></li><li><a href="/3-entrees/execution-schedule.html" class="sidebar-link">3.21. Execution Schedule</a></li><li><a href="/3-entrees/pallet-coupling.html" class="sidebar-link">3.22. Tightly- and Loosely-Coupled Pallets</a></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/3-entrees/testing/index" class="sidebar-heading clickable"><span>3.23. Testing</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/3-entrees/testing/mock.html" class="sidebar-link">3.23.1. Basic Test Environments</a></li><li><a href="/3-entrees/testing/common.html" class="sidebar-link">3.23.2. Common Testsg</a></li><li><a href="/3-entrees/testing/off-chain-workers.html" class="sidebar-link">3.23.3. Off-chain Worker Test Environment</a></li><li><a href="/3-entrees/testing/externalities.html" class="sidebar-link">3.23.4. Custom Test Environment</a></li></ul></section></li><li><a href="/3-entrees/safemath.html" class="sidebar-link">3.24. Safe Math</a></li></ul></section></li><li><a href="/more-resources.html" class="sidebar-link">4. More Resources</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><!---->
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>Transactions in Off-chain Workers</h1> <div data-v-3b7f5bdf><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="transactions-in-off-chain-workers"><a href="#transactions-in-off-chain-workers" class="header-anchor">#</a> Transactions in Off-chain Workers</h1> <p><code>pallets/offchain-demo</code> <a href="https://playground-staging.substrate.dev/?deploy=recipes&amp;files=%2Fhome%2Fsubstrate%2Fworkspace%2Fpallets%2Foffchain-demo%2Fsrc%2Flib.rs" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Playground-Try%20it!-brightgreen?logo=Parity%20Substrate" alt="Try on playground"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Github-View%20Code-brightgreen?logo=github" alt="View on GitHub"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="compiling-this-pallet"><a href="#compiling-this-pallet" class="header-anchor">#</a> Compiling this Pallet</h2> <p>This <code>offchain-demo</code> pallet is included in the
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/runtimes/ocw-runtime" target="_blank" rel="noopener noreferrer">ocw-runtime<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
That runtime can be used in the kitchen node.</p> <p>In order to utilize the off-chain worker, the node must inject keys into its keystore. To do so, we
open the <code>nodes/kitchen-node/Cargo.toml</code> file, enable the <code>ocw-runtime</code> package and comment out the
<code>super-runtime</code> package.</p> <p>Then we build the kitchen node with <code>ocw</code> feature flag:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Switch to kitchen-node directory</span>
<span class="token builtin class-name">cd</span> nodes/kitchen-node

<span class="token comment"># Compile with OCW feature</span>
cargo build --release --features ocw
</code></pre></div><h2 id="life-cycle-of-off-chain-worker"><a href="#life-cycle-of-off-chain-worker" class="header-anchor">#</a> Life-cycle of Off-chain Worker</h2> <p>Running the <code>kitchen-node</code> we see off-chain worker runs after each block generation
phase, as shown by <code>Entering off-chain workers</code> in the node output message:</p> <div class="language- extra-class"><pre class="language-text"><code>...
2020-03-14 13:30:36 Starting BABE Authorship worker
2020-03-14 13:30:36 Prometheus server started at 127.0.0.1:9615
2020-03-14 13:30:41 Idle (0 peers), best: #0 (0x2658…9a5b), finalized #0 (0x2658…9a5b), ⬇ 0 ⬆ 0
2020-03-14 13:30:42 Starting consensus session on top of parent 0x26582455e63448e8dafe1e70f04d7d74d39358c6b71c306eb7013e2c54069a5b
2020-03-14 13:30:42 Prepared block for proposing at 1 [hash: 0xdc7a76fc89c45a3f318e29df06cbdb097cc3094112b204f10e1e84e0799eba88; parent_hash: 0x2658…9a5b; extrinsics (1): [0xf572…63c0]]
2020-03-14 13:30:42 Pre-sealed block for proposal at 1. Hash now 0x3558accae1325a2ae5569512b8542e90ae11b4f0de6834ba901eb03b97a680aa, previously 0xdc7a76fc89c45a3f318e29df06cbdb097cc3094112b204f10e1e84e0799eba88.
2020-03-14 13:30:42 New epoch 0 launching at block 0x3558…80aa (block slot 264027307 &gt;= start slot 264027307).
2020-03-14 13:30:42 Next epoch starts at slot 264027407
2020-03-14 13:30:42 Imported #1 (0x3558…80aa)
2020-03-14 13:30:42 Entering off-chain workers
2020-03-14 13:30:42 off-chain send_signed: acc: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY| number: 0
...
</code></pre></div><p>If we refer to the code at
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>pallets/offchain-demo/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
there is an <code>offchain_worker</code> function inside <code>decl_module!</code>. This is the entry point of the
off-chain worker which is executed once per block generation, so all the off-chain
logic is here.</p> <p>Two kinds of transactions can be sent back on-chain from off-chain workers, <strong>Signed Transactions</strong>
and <strong>Unsigned Transactions</strong>. Signed transactions are used if the transaction requires the sender
to be specified. Unsigned transactions are used when the sender does not need to be known and
additional logic in the code provides additional data verification.</p> <p>Let's walk through how to set each one up:</p> <h2 id="signed-transactions"><a href="#signed-transactions" class="header-anchor">#</a> Signed Transactions</h2> <blockquote><p><strong>Notes</strong>: This example will have account <code>Alice</code> submitting signed transactions to the node in
the off-chain worker, and these transactions have associated fees. If we run the node in development
mode (with <code>--dev</code> flag) using the default sr25519 crypto signature, <code>Alice</code> will have initial funds
deposited and this example will run all fine.</p> <p>If this is not done in development mode or switched to another crypto signature, please
be aware that <code>Alice</code> must be setup and be funded to run this example.</p></blockquote> <h3 id="setup"><a href="#setup" class="header-anchor">#</a> Setup</h3> <p>For signed transactions, we have to define a crypto signature sub-module:</p> <p><a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>pallets/offchain-demo/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">KEY_TYPE</span><span class="token punctuation">:</span> <span class="token class-name">KeyTypeId</span> <span class="token operator">=</span> <span class="token class-name">KeyTypeId</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">b&quot;demo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">crypto</span> <span class="token punctuation">{</span>
	<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token constant">KEY_TYPE</span><span class="token punctuation">;</span>
	<span class="token keyword">use</span> <span class="token namespace">sp_runtime<span class="token punctuation">::</span>app_crypto<span class="token punctuation">::</span></span><span class="token punctuation">{</span>app_crypto<span class="token punctuation">,</span> sr25519<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token macro property">app_crypto!</span><span class="token punctuation">(</span>sr25519<span class="token punctuation">,</span> <span class="token constant">KEY_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>KEY_TYPE</code> is the application key prefix for the pallet in underlying storage.</p> <p>Second, we have added an additional associated type <code>AuthorityId</code>.</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>pallets/offchain-demo/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token class-name">Trait</span><span class="token punctuation">:</span> <span class="token namespace">system<span class="token punctuation">::</span></span><span class="token class-name">Trait</span> <span class="token punctuation">{</span>
	<span class="token comment">//...snip</span>
	<span class="token keyword">type</span> <span class="token class-name">AuthorityId</span><span class="token punctuation">:</span> <span class="token class-name">AppCrypto</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Public</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Signature</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This associated type needs to be specified by the runtime when it implements this pallet trait.</p> <p>Now if we build the <code>kitchen-node</code>, we will see the compiler return with three trait
bounds that are not satisfied: <code>Runtime: frame_system::offchain::CreateSignedTransaction</code>,
<code>frame_system::offchain::SigningTypes</code>, and <code>frame_system::offchain::SendTransactionTypes</code>.
We also learn that when using <code>SubmitSignedTransaction</code>, our runtime need to implement
<a href="https://substrate.dev/rustdocs/v2.0.0-rc4/frame_system/offchain/trait.CreateSignedTransaction.html" target="_blank" rel="noopener noreferrer"><code>CreateSignedTransaction</code> trait<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/runtimes/ocw-runtime/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>runtimes/ocw-runtime/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">LocalCall</span><span class="token operator">&gt;</span> <span class="token namespace">frame_system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span></span><span class="token class-name">CreateSignedTransaction</span><span class="token operator">&lt;</span><span class="token class-name">LocalCall</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">Runtime</span>
<span class="token keyword">where</span>
	<span class="token class-name">Call</span><span class="token punctuation">:</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">LocalCall</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
	<span class="token keyword">fn</span> <span class="token function-definition function">create_transaction</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token namespace">frame_system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span></span><span class="token class-name">AppCrypto</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Public</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Signature</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>
		call<span class="token punctuation">:</span> <span class="token class-name">Call</span><span class="token punctuation">,</span>
		public<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token class-name">Signature</span> <span class="token keyword">as</span> <span class="token namespace">sp_runtime<span class="token punctuation">::</span>traits<span class="token punctuation">::</span></span><span class="token class-name">Verify</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">Signer</span><span class="token punctuation">,</span>
		account<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span>
		index<span class="token punctuation">:</span> <span class="token class-name">Index</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token punctuation">(</span>
		<span class="token class-name">Call</span><span class="token punctuation">,</span>
		<span class="token operator">&lt;</span><span class="token class-name">UncheckedExtrinsic</span> <span class="token keyword">as</span> <span class="token namespace">sp_runtime<span class="token punctuation">::</span>traits<span class="token punctuation">::</span></span><span class="token class-name">Extrinsic</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">SignaturePayload</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> period <span class="token operator">=</span> <span class="token class-name">BlockHashCount</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u64</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> current_block <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">::</span><span class="token function">block_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">saturated_into</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">saturating_sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> tip <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> extra<span class="token punctuation">:</span> <span class="token class-name">SignedExtra</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
			<span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">CheckTxVersion</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">CheckGenesis</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">CheckEra</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token namespace">generic<span class="token punctuation">::</span></span><span class="token class-name">Era</span><span class="token punctuation">::</span><span class="token function">mortal</span><span class="token punctuation">(</span>period<span class="token punctuation">,</span> current_block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">CheckNonce</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token namespace">frame_system<span class="token punctuation">::</span></span><span class="token class-name">CheckWeight</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token namespace">pallet_transaction_payment<span class="token punctuation">::</span></span><span class="token class-name">ChargeTransactionPayment</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>tip<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token attribute attr-name">#[cfg_attr(not(feature = <span class="token string">&quot;std&quot;</span>), allow(unused_variables))]</span>
		<span class="token keyword">let</span> raw_payload <span class="token operator">=</span> <span class="token class-name">SignedPayload</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>call<span class="token punctuation">,</span> extra<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
				<span class="token namespace">debug<span class="token punctuation">::</span>native<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">&quot;SignedPayload error: {:?}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

		<span class="token keyword">let</span> signature <span class="token operator">=</span> raw_payload<span class="token punctuation">.</span><span class="token function">using_encoded</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>payload<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">C</span><span class="token punctuation">::</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> public<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

		<span class="token keyword">let</span> address <span class="token operator">=</span> account<span class="token punctuation">;</span>
		<span class="token keyword">let</span> <span class="token punctuation">(</span>call<span class="token punctuation">,</span> extra<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> raw_payload<span class="token punctuation">.</span><span class="token function">deconstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>call<span class="token punctuation">,</span> <span class="token punctuation">(</span>address<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> extra<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...snip</span>
</code></pre></div><p>The overall goal is to execute the following:</p> <ul><li>Sign the <code>call</code> and <code>extra</code>, also called 'signed extension'</li> <li>Making the call (<code>call</code>, which includes the call paramters) and passing the sender <code>address</code>,
signature of the data <code>signature</code>, and ensuring its signed extension <code>extra</code> on-chain as a transaction.</li></ul> <p><code>SignedExtra</code> data type will be defined later in the runtime.</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/runtimes/ocw-runtime/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>runtimes/ocw-runtime/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">/// The SignedExtension to the basic transaction logic.</span>
<span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token class-name">SignedExtra</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token namespace">system<span class="token punctuation">::</span></span><span class="token class-name">CheckTxVersion</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token namespace">system<span class="token punctuation">::</span></span><span class="token class-name">CheckGenesis</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token namespace">system<span class="token punctuation">::</span></span><span class="token class-name">CheckEra</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token namespace">system<span class="token punctuation">::</span></span><span class="token class-name">CheckNonce</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token namespace">system<span class="token punctuation">::</span></span><span class="token class-name">CheckWeight</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token namespace">transaction_payment<span class="token punctuation">::</span></span><span class="token class-name">ChargeTransactionPayment</span><span class="token operator">&lt;</span><span class="token class-name">Runtime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Next, the remaining two traits are also implemented.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token namespace">frame_system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span></span><span class="token class-name">SigningTypes</span> <span class="token keyword">for</span> <span class="token class-name">Runtime</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span> <span class="token class-name">Public</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token class-name">Signature</span> <span class="token keyword">as</span> <span class="token namespace">sp_runtime<span class="token punctuation">::</span>traits<span class="token punctuation">::</span></span><span class="token class-name">Verify</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">Signer</span><span class="token punctuation">;</span>
	<span class="token keyword">type</span> <span class="token class-name">Signature</span> <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token operator">&gt;</span> <span class="token namespace">frame_system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span></span><span class="token class-name">SendTransactionTypes</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">Runtime</span>
<span class="token keyword">where</span>
	<span class="token class-name">Call</span><span class="token punctuation">:</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
	<span class="token keyword">type</span> <span class="token class-name">OverarchingCall</span> <span class="token operator">=</span> <span class="token class-name">Call</span><span class="token punctuation">;</span>
	<span class="token keyword">type</span> <span class="token class-name">Extrinsic</span> <span class="token operator">=</span> <span class="token class-name">UncheckedExtrinsic</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sending-signed-transactions"><a href="#sending-signed-transactions" class="header-anchor">#</a> Sending Signed Transactions</h3> <p>A signed transaction is sent with <code>T::SubmitSignedTransaction::submit_signed</code>, as shown below:</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>pallets/offchain-demo/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">send_signed</span><span class="token punctuation">(</span>block_number<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">BlockNumber</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">use</span> <span class="token namespace">system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span></span><span class="token class-name">SubmitSignedTransaction</span><span class="token punctuation">;</span>
	<span class="token comment">//..snip</span>

	<span class="token keyword">let</span> submission<span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> block_number<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u64</span><span class="token punctuation">;</span>
	<span class="token keyword">let</span> call <span class="token operator">=</span> <span class="token class-name">Call</span><span class="token punctuation">::</span><span class="token function">submit_number_signed</span><span class="token punctuation">(</span>submission<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Using `SubmitSignedTransaction` associated type we create and submit a transaction</span>
	<span class="token comment">//   representing the call, we've just created.</span>
	<span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">SubmitSignedTransaction</span><span class="token punctuation">::</span><span class="token function">submit_signed</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>acc<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>results <span class="token punctuation">{</span>
		<span class="token keyword">match</span> res <span class="token punctuation">{</span>
			<span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token namespace">debug<span class="token punctuation">::</span>native<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">&quot;off-chain send_signed: acc: {}| number: {}&quot;</span><span class="token punctuation">,</span> acc<span class="token punctuation">,</span> submission<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token namespace">debug<span class="token punctuation">::</span>native<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">&quot;[{:?}] Failed to submit signed tx: {:?}&quot;</span><span class="token punctuation">,</span> acc<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token class-name">Error</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">::</span><span class="token class-name">SendSignedError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We have a function reference to <code>Call::submit_number_signed(submission)</code>. This is the function we
are going to submit back to on-chain, and passing it to
<code>T::SubmitSignedTransaction::submit_signed(call)</code>.</p> <p>Notice that we run a loop in the returned result. This implies that the call may make
multiple transactions and return multiple results. The call is both signing and sending
the transaction with each of the accounts that can be found locally under the application crypto
(which we defined earlier in <code>pub mod crypto {...}</code>). This can be seen as the local accounts that
are managed under this pallet namespace. As we only have one key in the app crypto, so only
one signed transaction is made.</p> <p>Eventually, the <code>call</code> transaction will be made on-chain via the <code>create_transaction</code> function we defined
earlier when we implemented <code>CreateTransaction</code> trait in our runtime.</p> <p>The local account used to sign the transaction is inserted in the pallet app crypto, and lives in
the outer node's <a href="https://substrate.dev/rustdocs/v2.0.0-rc4/sc_service/index.html" target="_blank" rel="noopener noreferrer">service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/nodes/kitchen-node/src/service.rs" target="_blank" rel="noopener noreferrer"><code>nodes/kitchen-node/src/service.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new_full</span><span class="token punctuation">(</span>config<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token operator">&lt;</span><span class="token class-name">GenesisConfig</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
	<span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">impl</span> <span class="token class-name">AbstractService</span><span class="token punctuation">,</span> <span class="token class-name">ServiceError</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
	<span class="token comment">// ...snip</span>
	<span class="token keyword">let</span> dev_seed <span class="token operator">=</span> config<span class="token punctuation">.</span>dev_key_seed<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ...snip</span>
	<span class="token comment">// Initialize seed for signing transaction using off-chain workers</span>
	<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span> <span class="token operator">=</span> dev_seed <span class="token punctuation">{</span>
		service
			<span class="token punctuation">.</span><span class="token function">keystore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">insert_ephemeral_from_seed_by_type</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token namespace">runtime<span class="token punctuation">::</span>offchain_demo<span class="token punctuation">::</span>crypto<span class="token punctuation">::</span></span><span class="token class-name">Pair</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
				<span class="token operator">&amp;</span>seed<span class="token punctuation">,</span>
				<span class="token namespace">runtime<span class="token punctuation">::</span>offchain_demo<span class="token punctuation">::</span></span><span class="token constant">KEY_TYPE</span><span class="token punctuation">,</span>
			<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Dev Seed should always succeed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// ...snip</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="unsigned-transactions"><a href="#unsigned-transactions" class="header-anchor">#</a> Unsigned Transactions</h2> <h3 id="setup-2"><a href="#setup-2" class="header-anchor">#</a> Setup</h3> <p>By default, unsigned transactions are rejected by the runtime unless they are explicitly
allowed. So we need to write logic to allow unsigned transactions for certain particular
dispatched functions as follows:</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>pallets/offchain-demo/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Trait</span><span class="token operator">&gt;</span> <span class="token namespace">support<span class="token punctuation">::</span>unsigned<span class="token punctuation">::</span></span><span class="token class-name">ValidateUnsigned</span> <span class="token keyword">for</span> <span class="token class-name">Module</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">type</span> <span class="token class-name">Call</span> <span class="token operator">=</span> <span class="token class-name">Call</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

	<span class="token keyword">fn</span> <span class="token function-definition function">validate_unsigned</span><span class="token punctuation">(</span>_source<span class="token punctuation">:</span> <span class="token class-name">TransactionSource</span><span class="token punctuation">,</span> call<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Call</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">TransactionValidity</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Call</span><span class="token punctuation">::</span><span class="token function">submit_number_unsigned</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">=</span> call <span class="token punctuation">{</span>
			<span class="token namespace">debug<span class="token punctuation">::</span>native<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">&quot;off-chain send_unsigned: number: {}&quot;</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token class-name">ValidTransaction</span><span class="token punctuation">::</span><span class="token function">with_tag_prefix</span><span class="token punctuation">(</span><span class="token string">&quot;offchain-demo&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">UnsignedPriority</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">and_provides</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">b&quot;submit_number_unsigned&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">longevity</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">propagate</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token class-name">InvalidTransaction</span><span class="token punctuation">::</span><span class="token class-name">Call</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>By implementing <code>ValidateUnsigned</code>, the allowance logic is added inside the <code>validate_unsigned</code>
function. We verify that if the call is <code>Call::submit_number_unsigned</code> we return <code>Ok()</code>, otherwise <code>InvalidTransaction::Call</code>.</p> <p>Note that the<code>ValidTransaction</code> object has some fields that touch on concepts that we have not discussed
before:</p> <ul><li><code>priority</code>: Ordering of two transactions, given their dependencies are satisfied.</li> <li><code>requires</code>: List of tags the transaction depends on.</li> <li><code>provides</code>: List of tags provided by this transaction. Successfully importing the transaction
will enable other transactions that depend on these tags to be included as well.</li> <li>Both<code>provides</code> and
<code>requires</code> tags allow Substrate to build a dependency graph of transactions and import them in
the right order.</li> <li><code>longevity</code>: Transaction longevity, which describes the minimum number of blocks the transaction
is valid for. After this period the transaction should be removed from the pool or revalidated.</li> <li><code>propagate</code>: Indication if the transaction should be propagated to other peers. By setting to
<code>false</code> the transaction will still be considered for inclusion in blocks that are authored on
the current node, but will never be sent to other peers.</li></ul> <p>We are using the
<a href="https://github.com/rust-unofficial/patterns/blob/master/patterns/builder.md" target="_blank" rel="noopener noreferrer">builder pattern<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to
build up this object.</p> <p>Finally, to tell the runtime that we have our own <code>ValidateUnsigned</code> logic, we also need to pass
this as a parameter when constructing the runtime:</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/runtimes/ocw-runtime/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>runtimes/ocw-runtime/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token macro property">construct_runtime!</span><span class="token punctuation">(</span>
	<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Runtime</span> <span class="token keyword">where</span>
		<span class="token class-name">Block</span> <span class="token operator">=</span> <span class="token class-name">Block</span><span class="token punctuation">,</span>
		<span class="token class-name">NodeBlock</span> <span class="token operator">=</span> <span class="token namespace">opaque<span class="token punctuation">::</span></span><span class="token class-name">Block</span><span class="token punctuation">,</span>
		<span class="token class-name">UncheckedExtrinsic</span> <span class="token operator">=</span> <span class="token class-name">UncheckedExtrinsic</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//...snip</span>
		<span class="token class-name">OffchainDemo</span><span class="token punctuation">:</span> <span class="token namespace">offchain_demo<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Module</span><span class="token punctuation">,</span> <span class="token class-name">Call</span><span class="token punctuation">,</span> <span class="token class-name">Storage</span><span class="token punctuation">,</span> <span class="token class-name">Event</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">ValidateUnsigned</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sending-unsigned-transactions"><a href="#sending-unsigned-transactions" class="header-anchor">#</a> Sending Unsigned Transactions</h3> <p>We can now make an unsigned transaction from offchain worker with the
<code>T::SubmitUnsignedTransaction::submit_unsigned</code> function, as shown in the code.</p> <p>src:
<a href="https://github.com/substrate-developer-hub/recipes/tree/master/pallets/offchain-demo/src/lib.rs" target="_blank" rel="noopener noreferrer"><code>pallets/offchain-demo/src/lib.rs</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">send_unsigned</span><span class="token punctuation">(</span>block_number<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">BlockNumber</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">use</span> <span class="token namespace">system<span class="token punctuation">::</span>offchain<span class="token punctuation">::</span></span><span class="token class-name">SubmitUnsignedTransaction</span><span class="token punctuation">;</span>

	<span class="token keyword">let</span> submission<span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> block_number<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u64</span><span class="token punctuation">;</span>
	<span class="token comment">// the `block_number` param should be unique within each block generation phase</span>
	<span class="token keyword">let</span> call <span class="token operator">=</span> <span class="token class-name">Call</span><span class="token punctuation">::</span><span class="token function">submit_number_unsigned</span><span class="token punctuation">(</span>block_number<span class="token punctuation">,</span> submission<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">T</span><span class="token punctuation">::</span><span class="token class-name">SubmitUnsignedTransaction</span><span class="token punctuation">::</span><span class="token function">submit_unsigned</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
		<span class="token namespace">debug<span class="token punctuation">::</span>native<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to submit unsigned tx: {:?}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">&lt;</span><span class="token class-name">Error</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">::</span><span class="token class-name">SendUnsignedError</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As in signed transactions, we prepare a function reference with its parameters and call
<code>T::SubmitUnsignedTransaction::submit_unsigned</code>.</p> <h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <p>For writing test cases for off-chain worker, refer to our
<a href="/3-entrees/testing/off-chain-workers.html">testing section</a>.</p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/tianxiemaochiyu/the_book_of_substrate_zh_CN/edit/master/docs/3-entrees/off-chain-workers/transactions.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.66aa2515.js" defer></script><script src="/assets/js/3.911ff76f.js" defer></script><script src="/assets/js/1.8aeda072.js" defer></script><script src="/assets/js/43.611048bf.js" defer></script>
  </body>
</html>
